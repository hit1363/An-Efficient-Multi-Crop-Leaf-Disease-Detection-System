# Training Configuration File

# Model Settings
model:
  architecture: "mobilenetv2"  # Options: mobilenetv2, efficientnet_lite0
  input_shape: [224, 224, 3]
  num_classes: 30
  weights: "imagenet"  # Use ImageNet pre-trained weights
  include_top: false  # Exclude classification head
  dropout_rate: 0.5

# Dataset Settings
dataset:
  data_dir: "../dataset/processed"
  train_dir: "../dataset/processed/train"
  val_dir: "../dataset/processed/val"
  test_dir: "../dataset/processed/test"
  batch_size: 32
  shuffle_buffer: 1000
  prefetch_buffer: 4

# Data Augmentation
augmentation:
  rotation_range: 45
  width_shift_range: 0.2
  height_shift_range: 0.2
  shear_range: 0.2
  zoom_range: [0.8, 1.2]
  horizontal_flip: true
  vertical_flip: true
  brightness_range: [0.8, 1.2]
  fill_mode: "nearest"

# Training Settings
training:
  epochs: 50
  initial_learning_rate: 0.001
  batch_size: 32
  validation_split: 0.15
  
  # Transfer Learning Strategy
  freeze_base: true
  freeze_until_layer: 100  # Freeze first 100 layers
  unfreeze_epoch: 10  # Unfreeze after this epoch
  
  # Fine-tuning Learning Rate
  fine_tune_learning_rate: 0.0001

# Optimizer Settings
optimizer:
  name: "adam"  # Options: adam, sgd, rmsprop
  learning_rate: 0.001
  beta_1: 0.9
  beta_2: 0.999
  epsilon: 1.0e-7
  decay: 0.0

# Learning Rate Schedule
lr_schedule:
  type: "reduce_on_plateau"  # Options: reduce_on_plateau, exponential_decay, cosine_decay
  monitor: "val_loss"
  factor: 0.5
  patience: 5
  min_lr: 1.0e-7

# Loss Function
loss:
  name: "categorical_crossentropy"  # Options: categorical_crossentropy, focal_loss
  
# Class Weights (for imbalanced dataset)
class_weights:
  enabled: true
  auto_compute: true  # Automatically compute from dataset

# Callbacks
callbacks:
  # Model Checkpoint
  checkpoint:
    enabled: true
    monitor: "val_accuracy"
    save_best_only: true
    save_weights_only: false
    mode: "max"
    save_freq: "epoch"
  
  # Early Stopping
  early_stopping:
    enabled: true
    monitor: "val_loss"
    patience: 10
    restore_best_weights: true
    mode: "min"
  
  # TensorBoard
  tensorboard:
    enabled: true
    log_dir: "../logs"
    histogram_freq: 1
    write_graph: true
    write_images: false
    update_freq: "epoch"
  
  # CSV Logger
  csv_logger:
    enabled: true
    filename: "../results/training_log.csv"
    append: false

# Model Export
export:
  save_dir: "../models"
  formats: ["h5", "saved_model", "tflite"]
  
# Evaluation Metrics
metrics:
  - "accuracy"
  - "precision"
  - "recall"
  - "auc"

# Hardware Settings
hardware:
  gpu: true
  mixed_precision: false  # Enable for faster training on modern GPUs
  multi_gpu: false
  num_gpus: 1

# Reproducibility
seed: 42

# Logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  save_to_file: true
  log_file: "../logs/training.log"

# Experiment Tracking
mlflow:
  enabled: false
  tracking_uri: "http://localhost:5000"
  experiment_name: "multi-crop-disease-detection"

wandb:
  enabled: false
  project: "leaf-disease-detection"
  entity: "your-username"
